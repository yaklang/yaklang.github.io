"use strict";(self.webpackChunkyaklang=self.webpackChunkyaklang||[]).push([[4928],{15680:(e,n,r)=>{r.d(n,{xA:()=>c,yg:()=>f});var a=r(96540);function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function l(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,a)}return r}function i(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?l(Object(r),!0).forEach(function(n){t(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function o(e,n){if(null==e)return{};var r,a,t=function(e,n){if(null==e)return{};var r,a,t={},l=Object.keys(e);for(a=0;a<l.length;a++)r=l[a],n.indexOf(r)>=0||(t[r]=e[r]);return t}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)r=l[a],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}var p=a.createContext({}),u=function(e){var n=a.useContext(p),r=n;return e&&(r="function"==typeof e?e(n):i(i({},n),e)),r},c=function(e){var n=u(e.components);return a.createElement(p.Provider,{value:n},e.children)},s="mdxType",y={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef(function(e,n){var r=e.components,t=e.mdxType,l=e.originalType,p=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),s=u(r),d=t,f=s["".concat(p,".").concat(d)]||s[d]||y[d]||l;return r?a.createElement(f,i(i({ref:n},c),{},{components:r})):a.createElement(f,i({ref:n},c))});function f(e,n){var r=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var l=r.length,i=new Array(l);i[0]=d;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o[s]="string"==typeof e?e:t,i[1]=o;for(var u=2;u<l;u++)i[u]=r[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}d.displayName="MDXCreateElement"},21509:(e,n,r)=>{r.r(n),r.d(n,{contentTitle:()=>i,default:()=>s,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var a=r(58168),t=(r(96540),r(15680));const l={sidebar_position:5},i="05.\u56fe\u7247\u4e0a\u4f20\uff1a\u68c0\u67e5\u6587\u4ef6\u5934\uff0c\u9700\u914d\u5408\u5305\u542b",o={unversionedId:"vulinbox/FileUpload/05unsafe-fileheader",id:"vulinbox/FileUpload/05unsafe-fileheader",isDocsHomePage:!1,title:"05.\u56fe\u7247\u4e0a\u4f20\uff1a\u68c0\u67e5\u6587\u4ef6\u5934\uff0c\u9700\u914d\u5408\u5305\u542b",description:"\u6587\u4ef6\u4e0a\u4f20\u68c0\u67e5\u6587\u4ef6\u5934\u662f\u4e00\u79cd\u9632\u5fa1\u63aa\u65bd\uff0c\u65e8\u5728\u786e\u4fdd\u7528\u6237\u4e0a\u4f20\u7684\u6587\u4ef6\u7c7b\u578b\u4e0e\u5176\u58f0\u660e\u7684\u6587\u4ef6\u7c7b\u578b\u4e00\u81f4\uff0c\u4ece\u800c\u907f\u514d\u6076\u610f\u6587\u4ef6\u7684\u4e0a\u4f20\u548c\u6267\u884c\uff0c\u4f46\u662f\u5f53\u5e94\u7528\u5b58\u5728\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e\u65f6\uff0c\u4ecd\u4f1a\u9020\u6210\u4ee3\u7801\u6267\u884c\u3002",source:"@site/Yaklab/vulinbox/FileUpload/05unsafe-fileheader.mdx",sourceDirName:"vulinbox/FileUpload",slug:"/vulinbox/FileUpload/05unsafe-fileheader",permalink:"/en/Yaklab/vulinbox/FileUpload/05unsafe-fileheader",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"teamSidebar",previous:{title:"04.CVE-2017-15715\uff1aApache HTTPD \u6362\u884c\u89e3\u6790\u6f0f\u6d1e",permalink:"/en/Yaklab/vulinbox/FileUpload/04unsafe-cve201715715"},next:{title:"\u6ca1\u6709\u4fdd\u62a4\u7684\u8868\u5355",permalink:"/en/Yaklab/vulinbox/CSRF/01unsafe-csrf"}},p=[{value:"\u793a\u4f8b\u4ee3\u7801\uff1a",id:"\u793a\u4f8b\u4ee3\u7801",children:[]},{value:"\u653b\u51fb\u793a\u4f8b\uff1a",id:"\u653b\u51fb\u793a\u4f8b",children:[]},{value:"\u9632\u5fa1\u63aa\u65bd\uff1a",id:"\u9632\u5fa1\u63aa\u65bd",children:[]},{value:"\u9776\u573a\u6f14\u793a\uff1a \u89c6\u9891",id:"\u9776\u573a\u6f14\u793a-\u89c6\u9891",children:[]}],u={toc:p},c="wrapper";function s({components:e,...n}){return(0,t.yg)(c,(0,a.A)({},u,n,{components:e,mdxType:"MDXLayout"}),(0,t.yg)("h1",{id:"05\u56fe\u7247\u4e0a\u4f20\u68c0\u67e5\u6587\u4ef6\u5934\u9700\u914d\u5408\u5305\u542b"},"05.\u56fe\u7247\u4e0a\u4f20\uff1a\u68c0\u67e5\u6587\u4ef6\u5934\uff0c\u9700\u914d\u5408\u5305\u542b"),(0,t.yg)("p",null,"\u6587\u4ef6\u4e0a\u4f20\u68c0\u67e5\u6587\u4ef6\u5934\u662f\u4e00\u79cd\u9632\u5fa1\u63aa\u65bd\uff0c\u65e8\u5728\u786e\u4fdd\u7528\u6237\u4e0a\u4f20\u7684\u6587\u4ef6\u7c7b\u578b\u4e0e\u5176\u58f0\u660e\u7684\u6587\u4ef6\u7c7b\u578b\u4e00\u81f4\uff0c\u4ece\u800c\u907f\u514d\u6076\u610f\u6587\u4ef6\u7684\u4e0a\u4f20\u548c\u6267\u884c\uff0c\u4f46\u662f\u5f53\u5e94\u7528\u5b58\u5728\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e\u65f6\uff0c\u4ecd\u4f1a\u9020\u6210\u4ee3\u7801\u6267\u884c\u3002"),(0,t.yg)("h3",{id:"\u793a\u4f8b\u4ee3\u7801"},"\u793a\u4f8b\u4ee3\u7801\uff1a"),(0,t.yg)("p",null,"\u786e\u4fdd\u4e0a\u4f20\u7684\u6587\u4ef6\u7c7b\u578b\u4e0e\u5176\u58f0\u660e\u7684\u6587\u4ef6\u7c7b\u578b\u4e00\u81f4"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-Go"},'fn := header.Filename\nt, _, err := mime.ParseMediaType(header.Header.Get("Content-Type"))\nif err != nil {\n  Failed(writer, request, "mimt.ParseMediaType Failed: %s", err)\n  return}\n\nmimeCheckType, _ := filetype.MatchReader(&buf)\nif !utils.IContains(mimeCheckType.MIME.Value, "image/") {\n        unsafeTemplateRender(writer, request, uploadFailed, map[string]any{\n                "reason": fmt.Sprintf("upload failed: mime header: %v, filetype actually: %v", t, mimeCheckType.MIME.Value),\n        })\n        return\n}\n\n')),(0,t.yg)("h3",{id:"\u653b\u51fb\u793a\u4f8b"},"\u653b\u51fb\u793a\u4f8b\uff1a"),(0,t.yg)("p",null,"\u4e0a\u4f20\u5177\u6709\u6b63\u5e38\u6587\u4ef6\u5934\u7684\u56fe\u7247\u9a6c\u5373\u53ef"),(0,t.yg)("p",null,(0,t.yg)("img",{src:r(23882).A})),(0,t.yg)("p",null,(0,t.yg)("img",{src:r(38113).A})),(0,t.yg)("p",null,"\u56fe\u7247\u9a6c\u5236\u4f5c\u65b9\u5f0f\uff1a"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},"\u6587\u672c\u65b9\u5f0f\u6253\u5f00,\u672b\u5c3e\u7c98\u8d34\u4e00\u53e5\u8bdd\u6728\u9a6c"),(0,t.yg)("li",{parentName:"ul"},"cmd \u4e2d copy 1.jpg/b+2.php 3.jpg"),(0,t.yg)("li",{parentName:"ul"},"16 \u8fdb\u5236\u6253\u5f00\u56fe\u7247\u5728\u672b\u5c3e\u6dfb\u52a0\u4e00\u53e5\u8bdd\u6728\u9a6c")),(0,t.yg)("h3",{id:"\u9632\u5fa1\u63aa\u65bd"},"\u9632\u5fa1\u63aa\u65bd\uff1a"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},"\u6587\u4ef6\u6269\u5c55\u540d\u68c0\u67e5\uff1a\u68c0\u67e5\u6587\u4ef6\u6269\u5c55\u540d\u662f\u5426\u4e0e\u6587\u4ef6\u5185\u5bb9\u7684\u5b9e\u9645\u7c7b\u578b\u5339\u914d\uff0c\u9632\u6b62\u6587\u4ef6\u540d\u7ed5\u8fc7\u3002"),(0,t.yg)("li",{parentName:"ul"},"\u767d\u540d\u5355\u6821\u9a8c\uff1a\u53ea\u5141\u8bb8\u4e0a\u4f20\u5b89\u5168\u3001\u53ef\u4fe1\u4efb\u7684\u6587\u4ef6\u7c7b\u578b\uff0c\u5e76\u62d2\u7edd\u6240\u6709\u5176\u4ed6\u7c7b\u578b\u7684\u6587\u4ef6\u3002"),(0,t.yg)("li",{parentName:"ul"},"\u6587\u4ef6\u5b58\u50a8\u8def\u5f84\uff1a\u5c06\u4e0a\u4f20\u7684\u6587\u4ef6\u5b58\u50a8\u5728\u5b89\u5168\u76ee\u5f55\u4e2d\uff0c\u786e\u4fdd\u4e0d\u5141\u8bb8\u7528\u6237\u4e0a\u4f20\u7684\u6587\u4ef6\u6267\u884c\u6216\u5305\u542b\u4efb\u610f\u4ee3\u7801\u3002"),(0,t.yg)("li",{parentName:"ul"},"\u9650\u5236\u6587\u4ef6\u5927\u5c0f\uff1a\u9650\u5236\u4e0a\u4f20\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u9632\u6b62\u5927\u6587\u4ef6\u5360\u7528\u670d\u52a1\u5668\u8d44\u6e90\u548c\u5b58\u50a8\u7a7a\u95f4\u3002"),(0,t.yg)("li",{parentName:"ul"},"\u9632\u6b62\u76ee\u5f55\u7a7f\u8d8a\uff1a\u786e\u4fdd\u4e0a\u4f20\u7684\u6587\u4ef6\u4e0d\u80fd\u901a\u8fc7\u6587\u4ef6\u540d\u6216\u8def\u5f84\u7ed5\u8fc7\u5e94\u7528\u7a0b\u5e8f\u7684\u5b89\u5168\u68c0\u67e5\u8bbf\u95ee\u5176\u4ed6\u76ee\u5f55\u3002")),(0,t.yg)("h3",{id:"\u9776\u573a\u6f14\u793a-\u89c6\u9891"},"\u9776\u573a\u6f14\u793a\uff1a \u89c6\u9891"),(0,t.yg)("video",{src:"/img/yaklab/fileupload/04unsafe-fileheader.mp4",loop:!0,playsInline:!0,controls:!0,autoPlay:!0,style:{width:890}}))}s.isMDXComponent=!0},23882:(e,n,r)=>{r.d(n,{A:()=>a});const a=r.p+"assets/images/04unsafe-fileheader01-43ece700937862e655026fb30ae040ae.png"},38113:(e,n,r)=>{r.d(n,{A:()=>a});const a=r.p+"assets/images/04unsafe-fileheader02-285eb3f299a5fe60a7193ba17ab69901.png"}}]);